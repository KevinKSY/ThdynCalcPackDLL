      subroutine eqmpTF(p,T,F,d,s,u,h,R,cp,cv,k)
c ......................................................................
c ... This routine computes thermodynamic properties of combustion pro-
c     ducts formed by combustion of a C-H-O-N fuel and an oxidant con-
c     sisting of O2 and specified amounts of N2,Ar,CO2,H2O,CO and H2
c     at chemical equilibrium.
c ......................................................................
c ... Reference:
c     H. Valland: "Computation of thermodynamic properties of combustion
c                 products of a C-H-O-N fuel and processes involving
c                 combustion and combustion products" (in Norwegian).
c                 Department of marine technology, NTNU, 2002
c ......................................................................
c ... Input parameters:
c     p     pressure [Pa]
c     T     temperature [K]
c     F     fuel air equivalence ratio [-] (F = 1/lambda)
c ... Output parameters:
c     d     density [kg/m3]
c     s     specific entropy [J/kgK]
c     u     specific internal energy [J/kg]
c     h     specific enthalpy [J/kg]
c     R     gas constant [J/kgK]
c     cp    specific heat at constant pressure [J/kgK]
c     cv    specific heat at constant volume [J/kgK]
c     k     ratio of specific heats: k=cp/cv [-] 
c ... Note:
c     SI-units apply:
c     energy: [J]   mass: [kg]   pressure: [Pa]=[N/m2]  temperature: [K]
c ......................................................................
c ... Programmed:  H. VALLAND   
c ... Date:  1983-03-10
c     Last update: 2002-10-11/hv
c **********************************************************************
      implicit none
      integer I,IT,IN
c      integer IERR
c      real p,T,F
      real p,T,F,d,s,u,h,R,cp,cv,k
      real TK,FR,CTF
      REAL P0,R0,CONV
      real SH(12),SM(12),SC(12),SS(12),HHT(386),CT(386),SST(386)   
c
c      real X(12),DXT(12),DXP(12),DXF(12)
c      real FC(4),AC(6),fs
c
      real          HTF,UTF,STF,GTF,ATF,DMFDT,DHTDT,DUTDT,
     +              DSTDT,DGTDT,DATDT,DMFDP,DHTDP,DUTDP,
     +              DSTDP,DGTDP,DATDP,DMFDF,DHTDF,DUTDF,
     +              DSTDF,DGTDF,DATDF
c
      real       g,a,MF
c
c      common /BLOC/FC,AC,fs
c      common /TAB/X,DXT,DXP,DXF
      include '..\cbl\reacts.cbl'
      include '..\cbl\produc.cbl'
c
c      real         pq,Tq,Fq,dq,sq,uq,hq,gq,aq,Rq,
c     &                      dp,sp,up,hp,gp,ap,Rp,
c     &                      dT,sT,uT,hT,gT,aT,RT,
c     &                      dF,sF,uF,hF,gF,aF,RF
c      common /prop/pq,Tq,Fq,dq,sq,uq,hq,gq,aq,Rq,
c     &                      dp,sp,up,hp,gp,ap,Rp,
c     &                      dT,sT,uT,hT,gT,aT,RT,
c     &                      dF,sF,uF,hF,gF,aF,RF
      include '..\cbl\propty.cbl'
c ----------------------------------------------------------------------
c ----------------------------------------------------------------------
      DATA P0,R0,CONV/101325.,8314.4,4184.4/
      DATA SM/ 1.008,16.000,14.008,2.016,17.007,28.011,30.008,31.999,
     +        18.016,44.010,28.013,39.944/  
c
c ----------------------------------------------------------------------
c ... Total enthalpy ( H )  [ kcal. /mole ]
c ----------------------------------------------------------------------
c
c ... Hydrogen, monoatomic (H)
c
      DATA (HHT(I),I=1,35 )/    54.612, 55.108, 55.605, 56.102, 56.599,
     + 57.096, 57.593, 58.089, 58.586, 59.083, 59.580, 60.077, 60.573,
     + 61.070, 61.567, 62.063, 62.561, 63.057, 63.554, 64.051, 64.548,
     + 65.045, 65.542, 66.038, 66.535, 67.032, 67.529, 68.026, 68.522,
     + 69.019, 69.516, 70.013, 70.510, 71.007, 71.508 /
c
c ... Oxygen, monoatomic (O)
c
      DATA (HHT(I),I=36,70 )/   62.141, 62.645, 63.147, 63.649, 64.149,
     + 64.648, 65.148, 65.646, 66.145, 66.643, 67.141, 67.639, 68.137,
     + 68.635, 69.133, 69.631, 70.129, 70.626, 71.124, 71.623, 72.121,
     + 72.620, 73.119, 73.619, 74.119, 74.620, 75.121, 75.623, 76.126,
     + 76.630, 77.134, 77.640, 78.146, 78.654, 79.162/
c
c ... Nitrogen, monoatomic (N)
c
      DATA (HHT(I),I=71,105)/  115.501,115.997,116.494,116.991,117.488,
     +117.985,118.482,118.978,119.475,119.972,120.469,120.966,121.462,
     +121.959,122.456,122.953,123.450,123.947,124.445,124.942,125.440,
     +125.939,126.438,126.937,127.438,127.940,128.442,128.947,129.452,
     +129.960,130.470,130.981,131.496,132.013,132.532/
c
c ... Hydrogen, diatomic (H)
c
      DATA (HHT(I),I=106,140)/   4.130,  4.832,  5.538,  6.250,  6.968,
     +  7.694,  8.428,  9.172,  9.926, 10.692, 11.470, 12.257, 13.054,
     + 13.860, 14.675, 15.499, 16.331, 17.170, 18.017, 18.872, 19.732,
     + 20.599, 21.472, 22.350, 23.234, 24.122, 25.016, 25.915, 26.818,
     + 27.727, 28.640, 29.559, 30.481, 31.409, 32.341/
c
c ... Hydroxyl (OH)
c
      DATA (HHT(I),I=141,175 )/ 13.618, 14.326, 15.037, 15.756, 16.484,
     + 17.223, 17.972, 18.733, 19.504, 20.286, 21.077, 21.878, 22.688,
     + 23.505, 24.330, 25.162, 26.001, 26.845, 27.695, 28.550, 29.410,
     + 30.275, 31.143, 32.016, 32.892, 33.772, 34.655, 35.541, 36.430,
     + 37.322, 38.216, 39.113, 40.013, 40.915, 41.819/
c
c ... Carbon monoxide (CO)
c
      DATA (HHT(I),I=176,210 )/-22.991,-22.255,-21.501,-20.731,-19.945,
     +-19.145,-18.334,-17.512,-16.682,-15.843,-14.998,-14.148,-13.292,
     +-12.431,-11.567,-10.698, -9.827, -8.953, -8.076, -7.197, -6.315,
     + -5.432, -4.546, -3.659, -2.771, -1.880,  -.989,  -.096,   .799,
     +  1.694,  2.591,  3.489,  4.388,  5.288,  6.188/
c
c ... Nitric oxide (NO)
c
      DATA (HHT(I),I=211,245 )/ 25.839, 26.595, 27.369, 28.160, 28.966,
     + 29.784, 30.613, 31.451, 33.297, 33.149, 34.007, 34.870, 35.737,
     + 36.608, 37.482, 38.359, 39.240, 40.122, 41.007, 41.894, 42.782, 
     + 43.673, 44.564, 45.458, 46.353, 47.249, 48.146, 49.045, 49.944, 
     + 50.845, 51.747, 52.650, 53.553, 54.458, 55.363/
c
c ... Oxygen (O2)
c
      DATA (HHT(I),I=246,280 )/  4.285,  5.063,  5.861,  6.675,  7.502,  
     +  8.341,  9.189, 10.046, 10.910, 11.781, 12.658, 13.540, 14.429,  
     + 15.324, 16.224, 17.129, 18.041, 18.957, 19.879, 20.807, 21.739,  
     + 22.677, 23.620, 24.568, 25.521, 26.478, 27.440, 28.406, 29.377,  
     + 30.351, 31.329, 32.311, 33.296, 34.284, 35.276/
c
c ... Water (H2O)
c
      DATA (HHT(I),I=281,315 )/-52.227,-51.346,-50.436,-49.496,-48.527,
     +-47.526,-46.496,-45.438,-44.352,-43.241,-42.106,-40.949,-39.772,
     +-38.576,-37.363,-36.134,-34.890,-33.633,-32.364,-31.083,-29.791,
     +-28.490,-27.180,-25.861,-24.535,-23.201,-21.860,-20.513,-19.159,
     +-17.800,-16.436,-15.067,-13.693,-12.314,-10.931/
c
c ... Carbon dioxide (CO2)
c
      DATA (HHT(I),I=316,350 )/-88.640,-87.482,-86.274,-85.025,-83.743,
     +-82.431,-81.095,-79.739,-78.365,-76.977,-75.575,-74.162,-72.740,
     +-71.309,-69.870,-68.424,-66.972,-65.515,-64.053,-62.586,-61.114,
     +-59.639,-58.160,-56.678,-55.192,-53.703,-52.212,-50.717,-49.220,
     +-47.721,-46.219,-44.715,-43.209,-41.700,-40.189/
c
c ... Nitrogen (N2)
c
      DATA (HHT(I),I=351,386 )/  4.197,  4.925,  5.668,  6.427,  7.201,
     +  7.989,  8.790,  9.601, 10.422, 11.251, 12.087, 12.930, 13.779,
     + 14.632, 15.490, 16.352, 17.218, 18.087, 18.958, 19.833, 20.710,
     + 21.589, 22.470, 23.352, 24.237, 25.123, 26.011, 26.901, 27.791,
     + 28.683, 29.577, 30.471, 31.367, 32.263, 33.161, 33.161/
c
c -------------------------------------------------------------------
c ... Specific heat capacity ( cp )  [ cal. /mole deg. ]
c -------------------------------------------------------------------
c
c ... Hydrogen, monoatomic
c
      DATA (CT(I),I=1,35)/      4.968,  4.968,  4.968,  4.968,  4.968,
     +  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,
     +  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,
     +  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,
     +  4.968,  4.968,  4.968,  4.968,  4.968,  4.968/
c
c ... Oxygen, monoatomic
c
      DATA(CT(I),I=36,70)/      5.049,  5.029,  5.015,  5.006,  4.999,  
     +  4.994,  4.990,  4.987,  4.984,  4.982,  4.981,  4.979,  4.979,  
     +  4.978,  4.978,  4.978,  4.979,  4.980,  4.981,  4.984,  4.986,  
     +  4.990,  4.994,  4.999,  5.004,  5.010,  5.017,  5.025,  5.033,  
     +  5.041,  5.050,  5.060,  5.070,  5.081,  5.091/
c
c ... Nitrogen, monoatomic
c
      DATA (CT(I),I=71,105)/    4.968,  4.968,  4.968,  4.968,  4.968,  
     +  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,  4.968,  
     +  4.969,  4.969,  4.969,  4.971,  4.972,  4.975,  4.978,  4.982,  
     +  4.987,  4.993,  5.001,  5.011,  5.022,  5.035,  5.050,  5.067,  
     +  5.086,  5.107,  5.130,  5.156,  5.183,  5.213/
c
c ... Hydrogen, diatomic
c
      DATA (CT(I),I=106,140)/   7.009,  7.036,  7.087,  7.148,  7.219,  
     +  7.300,  7.390,  7.490,  7.600,  7.720,  7.823,  7.921,  8.016,  
     +  8.108,  8.195,  8.279,  8.358,  8.434,  8.506,  8.575,  8.639,  
     +  8.700,  8.757,  8.810,  8.859,  8.911,  8.962,  9.012,  9.061,  
     +  9.110,  9.158,  9.205,  9.252,  9.297,  9.342/
c
c ... Hydroxyl
c
      DATA (CT(I),I=141,175 )/  7.057,  7.090,  7.150,  7.233,  7.332,  
     +  7.439,  7.549,  7.659,  7.766,  7.867,  7.966,  8.053,  8.137,  
     +  8.214,  8.286,  8.353,  8.415,  8.472,  8.526,  8.576,  8.622,  
     +  8.665,  8.706,  8.744,  8.780,  8.814,  8.846,  8.876,  8.905,  
     +  8.933,  8.959,  8.984,  9.008,  9.031,  9.053/
c
c ... Carbon monoxide
c
      DATA (CT(I),I=176,210 )/  7.276,  7.450,  7.624,  7.786,  7.931,  
     +  8.057,  8.168,  8.263,  8.346,  8.417,  8.480,  8.535,  8.583,  
     +  8.626,  8.664,  8.698,  8.728,  8.756,  8.781,  8.804,  8.825,  
     +  8.844,  8.863,  8.879,  8.895,  8.910,  8.924,  8.937,  8.949,  
     +  8.961,  8.973,  8.984,  8.994,  9.004,  9.014/
c
c ... Nitric oxide
c
      DATA (CT(I),I=211,245 )/  7.466,  7.655,  7.832,  7.988,  8.123,  
     +  8.238,  8.336,  8.419,  8.491,  8.552,  8.605,  8.651,  8.692,  
     +  8.727,  8.759,  8.788,  8.813,  8.837,  8.858,  8.877,  8.895,  
     +  8.912,  8.927,  8.941,  8.955,  8.968,  8.980,  8.991,  9.002,  
     +  9.012,  9.022,  9.032,  9.041,  9.050,  9.058/
c
c ... Oxygen
c
      DATA (CT(I),I=246,280 )/  7.670,  7.883,  8.063,  8.212,  8.336,  
     +  8.439,  8.527,  8.604,  8.674,  8.738,  8.800,  8.858,  8.916,  
     +  8.973,  9.029,  9.084,  9.139,  9.194,  9.248,  9.301,  9.354,  
     +  9.405,  9.455,  9.503,  9.551,  9.596,  9.640,  9.682,  9.723,  
     +  9.762,  9.799,  9.835,  9.869,  9.901,  9.932/
c
c ... Water
c
      DATA (CT(I),I=281,315 )/  8.676,  8.954,  9.246,  9.547,  9.851, 
     + 10.152, 10.444, 10.723, 10.987, 11.233, 11.462, 11.674, 11.869, 
     + 12.048, 12.214, 12.366, 12.505, 12.634, 12.753, 12.863, 12.965, 
     + 13.059, 13.146, 13.228, 13.304, 13.374, 13.441, 13.503, 13.562, 
     + 13.617, 13.669, 13.718, 13.764, 13.808, 13.850/
c
c ... Carbon dioxide
c
      DATA (CT(I),I=316,350 )/ 11.310, 11.846, 12.293, 12.667, 12.980, 
     + 13.243, 13.466, 13.656, 13.815, 13.953, 14.074, 14.177, 14.269, 
     + 14.352, 14.424, 14.489, 14.547, 14.600, 14.648, 14.692, 14.734, 
     + 14.771, 14.807, 14.841, 14.873, 14.902, 14.930, 14.956, 14.982, 
     + 15.006, 15.030, 15.053, 15.075, 15.097, 15.119/
c
c ... Nitrogen
c
      DATA (CT(I),I=351,386 )/  7.196,  7.350,  7.512,  7.670,  7.815,  
     +  7.945,  8.061,  8.162,  8.252,  8.330,  8.398,  8.458,  8.512,  
     +  8.559,  8.601,  8.638,  8.672,  8.703,  8.731,  8.756,  8.779,  
     +  8.800,  8.820,  8.838,  8.855,  8.871,  8.886,  8.900,  8.914,  
     +  8.927,  8.939,  8.950,  8.962,  8.972,  8.983,  8.983/  
c
c -------------------------------------------------------------------
c ... Total entropy  ( S )  [ cal. /mole deg. ]
c -------------------------------------------------------------------
c
c ... Hydrogen, monoatomic
c
      DATA (SST(I),I=1,35 )/    30.867, 31.632, 32.296, 32.881, 33.404,
     + 33.878, 34.310, 34.708, 35.076, 35.419, 35.739, 36.041, 36.325,
     + 36.593, 36.848, 37.090, 37.322, 37.542, 37.754, 37.957, 38.152,
     + 38.339, 38.520, 38.694, 38.862, 39.025, 39.183, 39.336, 39.484,
     + 39.628, 39.768, 39.904, 40.037, 40.166, 40.292/
c
c ... Oxygen, monoatomic
c
      DATA (SST(I),I=36,70 )/   42.054, 42.831, 43.501, 44.092, 44.619,
     + 45.095, 45.529, 45.928, 46.298, 46.642, 46.963, 47.265, 47.550,
     + 47.819, 48.074, 48.317, 48.549, 48.770, 48.982, 49.185, 49.381,
     + 49.569, 49.751, 49.926, 50.096, 50.260, 50.419, 50.573, 50.742,
     + 50.870, 51.012, 51.150, 51.285, 51.417, 51.546/
c
c ... Nitrogen, monoatomic
c
      DATA (SST(I),I=71,105 )/  40.089, 40.855, 41.518, 42.103, 42.627,
     + 43.100, 43.532, 43.930, 44.298, 44.641, 44.962, 45.263, 45.547,
     + 45.815, 46.070, 46.313, 46.544, 46.765, 46.977, 47.180, 47.375,
     + 47.563, 47.745, 47.920, 48.090, 48.254, 48.414, 48.569, 48.720,
     + 48.867, 49.011, 49.151, 49.288, 49.422, 49.554/
c
c ... Hydrogen
c
      DATA (SST(I),I=106,140 )/ 52.166, 53.300, 54.306, 55.213, 56.041,
     + 56.803, 57.508, 58.781, 59.360, 59.905, 60.421, 60.910, 61.374,
     + 61.374, 61.818, 62.241, 62.646, 63.035, 63.408, 63.767, 64.113,
     + 64.445, 64.768, 65.080, 65.381, 65.668, 65.995, 66.226, 66.497,
     + 66.753, 67.009, 67.252, 67.495, 67.726, 67.956/
c
c ... Hydroxyl ( OH )
c
      DATA (SST(I),I=141,175 )/ 48.837, 49.927, 50.877, 51.724, 52.491,
     + 53.195, 53.847, 54.455, 55.027, 55.566, 56.077, 56.563, 57.027,
     + 57.467, 57.891, 58.296, 58.686, 59.062, 59.424, 59.773, 60.110,
     + 60.436, 60.752, 61.058, 61.355, 61.644, 61.924, 62.197, 62.462,
     + 62.721, 62.972, 63.218, 63.458, 63.693, 63.922/
c
c ... Carbon monoxide
c
      DATA (SST(I),I=176,210 )/ 52.166, 53.300, 54.306, 55.213, 56.041,
     + 56.803, 57.508, 58.781, 59.360, 59.905, 60.421, 60.910, 61.374,
     + 61.374, 61.818, 62.241, 62.646, 63.035, 63.408, 63.767, 64.113,
     + 64.445, 64.768, 65.080, 65.381, 65.668, 65.995, 66.226, 66.497,
     + 66.753, 67.009, 67.252, 67.495, 67.726, 67.956/
c
c ... Nitric oxide
c
      DATA (SST(I),I=211,245 )/ 55.397, 56.562, 57.596, 58.528, 59.377,
     + 60.157, 60.878, 61.548, 62.175, 62.763, 63.317, 63.840, 64.335,
     + 64.806, 65.255, 65.683, 66.092, 66.484, 66.861, 67.223, 67.571,
     + 67.908, 68.232, 68.545, 68.849, 69.143, 69.427, 69.704, 69.973,
     + 70.234, 70.488, 70.735, 70.976, 71.211, 71.440/
c
c ... Oxygen
c
      DATA (SST(I),I=246,280 )/ 54.124, 55.275, 56.387, 57.346, 58.218,
     + 59.017, 59.755, 60.441, 61.081, 61.682, 62.248, 62.783, 63.291,
     + 63.775, 64.236, 64.678, 65.102, 65.509, 65.902, 66.280, 66.646,
     + 67.000, 67.343, 67.676, 67.999, 68.309, 68.618, 68.911, 69.205,
     + 69.564, 69.763, 70.029, 70.295, 70.548, 70.805/
c
c ... Water 
c
      DATA (SST(I),I=281,315 )/ 50.917, 52.275, 53.490, 54.596, 55.618,
     + 56.571, 57.467, 58.314, 59.118, 59.885, 60.602, 61.304, 61.976,
     + 62.623, 63.245, 63.845, 64.442, 64.981, 65.521, 66.044, 66.551,
     + 67.042, 67.518, 67.980, 68.447, 68.879, 69.310, 69.719, 70.128,
     + 70.517, 70.907, 71.278, 71.648, 71.817, 72.357/
c
c ... Carbon dioxide
c
      DATA (SST(I),I=316,350 )/ 58.138, 59.922, 61.533, 63.003, 64.355,
     + 65.605, 66.766, 67.851, 68.869, 69.827, 70.731, 71.587, 72.400,
     + 73.173, 73.911, 74.616, 75.292, 75.939, 76.562, 77.161, 77.738,
     + 78.293, 78.831, 79.351, 79.855, 80.336, 80.817, 81.270, 81.724,
     + 81.991, 82.258, 82.894, 83.394, 83.781, 84.168/
c
c ... Nitrogen
c
      DATA (SST(I),I=351,386 )/ 50.699, 51.820, 52.811, 53.705, 54.520,
     + 55.271, 55.968, 56.617, 57.224, 57.796, 58.336, 58.847, 59.332,
     + 59.794, 60.233, 60.654, 61.057, 61.443, 61.813, 62.170, 62.514,
     + 62.846, 63.166, 63.476, 63.776, 64.064, 64.348, 64.618, 64.888,
     + 65.143, 65.398, 65.639, 65.881, 66.111, 66.341, 66.341/
c
c --- End of data ------------------------------------------------------
c **********************************************************************
c ----------------------------------------------------------------------
c ... Call subroutine EQMX for calculation of molefractions and their
c     partial derivatives.  
c ----------------------------------------------------------------------
c 
      call ptf2x(P,T,F)
c
c      if(IERR .ne. 0)then
c         WRITE(6,*)'  ERROR OCCURED IN EQMX ** IERR = ',IERR
c         RETURN  
c      endif
c   
c ... Compute H, CP and S functions of T.   
c   
      TK=T/100. 
      IT=TK 
      FR=TK-FLOAT(IT)   
c
c ... Contribution from Argon:
c
      SH(12)=4.968*T*CONV
      SC(12)=4.968
      SS(12)=(36.9822 + SC(12)*ALOG(T/273.15))*CONV
      SC(12)=4.968*CONV
c
      do I=1,11 
         IN=35*(I-1)+(IT-5)
         SH(I)=(HHT(IN)+FR*(HHT(IN+1)-HHT(IN)))*1000.*CONV
         SC(I)=(CT(IN)+FR*(CT(IN+1)-CT(IN)))*CONV
         SS(I)=0.
         if(X(I) .gt. 0.)then
            SS(I)=(SST(IN)+FR*(SST(IN+1)-SST(IN)))*CONV-R0*ALOG(X(I))
         endif
      enddo
c
c ----------------------------------------------------------------------
c ... Calculate specific molar properties (per mole)
c ----------------------------------------------------------------------
c
      MF=0.0
      HTF=0.  
      CTF=0.0  
      STF =0.0
c
c ... Molar weight, enthalpy, entropy and specific heat (cp)
c 
      do I=1,12
         MF =MF+X(I)*SM(I)
         HTF=HTF+X(I)*SH(I)
         CTF=CTF+X(I)*SC(I)
         STF=STF+X(I)*SS(I)
      enddo
      STF=STF-R0*ALOG(P/P0)
c
c --- Internal energy, Gibbs free energy, Helmholtz func.
c
      UTF=HTF-R0*T
      GTF=HTF-STF*T
      ATF=UTF-STF*T
c
c ----------------------------------------------------------------------
c ... Derivatives as above w.r.t  p,T, and F
c ----------------------------------------------------------------------
c
      DMFDT=0.
      DHTDT=0.
      DSTDT=0.
      do I=1,12
         DMFDT=DMFDT+DXT(I)*SM(I)
         DHTDT=DHTDT+DXT(I)*SH(I)+X(I)*SC(I)
         if(X(I) .gt. 0.)then
            DSTDT=DSTDT+DXT(I)*(SS(I)-R0*(ALOG(X(I)+1.0)))+X(I)*SC(I)/T
         else
            DSTDT=DSTDT+DXT(I)*SS(I)
         endif
      enddo
c
      DUTDT=DHTDT-R0
      DGTDT=DHTDT-T*DSTDT-STF
      DATDT=DUTDT-T*DSTDT-STF
c
      DMFDP=0.
      DHTDP=0.
      DSTDP=0.
      do I=1,12
         DMFDP=DMFDP+DXP(I)*SM(I)
         DHTDP=DHTDP+DXP(I)*SH(I)
         if(X(I) .gt. 0.)then
            DSTDP=DSTDP+DXP(I)*(SS(I)-R0*(ALOG(X(I)+1.0)))
         else
            DSTDP=DSTDP+DXP(I)*SS(I)
         endif
      enddo
c
      DUTDP=DHTDP
      DSTDP=DSTDP-R0/P
      DGTDP=DHTDP-T*DSTDP
      DATDP=DUTDP-T*DSTDP     
c      
      DMFDF=0.
      DHTDF=0.
      DSTDF=0.
      do I=1,12
         DMFDF=DMFDF+DXF(I)*SM(I)
         DHTDF=DHTDF+DXF(I)*SH(I)
         if(X(I) .gt. 0.)then
            DSTDF=DSTDF+DXF(I)*(SS(I)-R0*(ALOG(X(I)+1.0)))
         else
            DSTDF=DSTDF+DXF(I)*SS(I)
         endif
      enddo
c
      DUTDF=DHTDF
      DGTDF=DHTDF-T*DSTDF
      DATDF=DUTDF-T*DSTDF
c
c ----------------------------------------------------------------------
c ... Mass specific properties (per kg)
c ----------------------------------------------------------------------
c
      R=R0/MF
      d=P/(R*T) 
      h=HTF/MF
      u=UTF/MF
      s=STF/MF
      g=GTF/MF
      a=ATF/MF
      pq=p
      Tq=T
      Fq=F
      dq=d
      sq=s
      uq=u
      hq=h
      gq=g
      aq=a
      Rq=R
c
      RT=-R*DMFDT/MF
      dT=d*(-1.0/T-RT/R)
      hT=(DHTDT-h*DMFDT)/MF      
      uT=(DUTDT-u*DMFDT)/MF
      sT=(DSTDT-s*DMFDT)/MF
      gT=(DGTDT-g*DMFDT)/MF
      aT=(DATDT-a*DMFDT)/MF
c
      Rp =-R*DMFDP/MF
      dp=d*(1.0/P-Rp/R)
      hp=(DHTDP-h*DMFDP)/MF      
      up=(DUTDP-u*DMFDP)/MF
      sp=(DSTDP-s*DMFDP)/MF
      gp=(DGTDP-g*DMFDP)/MF
      ap=(DATDP-a*DMFDP)/MF
c
      RF =-R*DMFDF/MF
      dF=-d*RF/R
      hF=(DHTDF-h*DMFDF)/MF      
      uF=(DUTDF-u*DMFDF)/MF
      sF=(DSTDF-s*DMFDF)/MF
      gF=(DGTDF-g*DMFDF)/MF
      aF=(DATDF-a*DMFDF)/MF
c
      cp=hT
      cv=cp-R
      k=cp/cv
      return
      END

